#!/bin/bash

case "$1" in

    --apply)


#list of files you want to save
kde=(
kactivitymanagerdrc
kscreenlockerrc
ksmserverrc
ksplashrc
plasma-org.kde.plasma.desktop-appletsrc
plasmashellrc
kwin_left
kwin_maximized_disable
kglobalshortcutsrc
klassyrc
panel-colorizer
)

mkdir -p ~/.kdebiglinux
rm -f ~/.config/enable_latte # Remove old conflict files

if [ "$3" = "quiet" ] || [ "$4" = "quiet" ]; then
    echo "No stop services"
else
    systemctl --user stop plasma-plasmashell
    systemctl --user stop plasma-kglobalaccel.service
fi

LAST_USED="$(<"$HOME/.kdebiglinux/lastused")"

# Backup config
if [ "$LAST_USED" != "" ]; then
    mkdir -p "$HOME/.kdebiglinux/$LAST_USED"
    #Clean latte
    rm -Rf "$HOME/.kdebiglinux/$LAST_USED/latte"
    #Move config to use later
    for i in "${kde[@]}"; do
        cp -Rf "$HOME/.config/$i" "$HOME/.kdebiglinux/$LAST_USED"
    done
fi


# Clean
if [ "$3" = "clean" ] && [ -e "/usr/share/biglinux/kdebiglinux/$2" ]; then
    rm -Rf "$HOME/.kdebiglinux/$2"
fi

# Apply config
if [ -e "$HOME/.kdebiglinux/$2" ]; then

    #Fix kwin button
    rm -f "$HOME/.config/kwin_left"
    #Fix kwin maximized
    rm -f "$HOME/.config/kwin_maximized_disable"
    #Save lastused
    echo "$2" > $HOME/.kdebiglinux/lastused

    #Move config to use now
    for i in "${kde[@]}"; do
        cp -Rf "$HOME/.kdebiglinux/$2/$i" "/$HOME/.config/$i"
    done
else
    if [ -e "/usr/share/biglinux/kdebiglinux/$2" ]; then

        #Fix kwin button
        rm -Rf "$HOME/.config/kwin_left"
        #Fix kwin maximized
        rm -f "$HOME/.config/kwin_maximized_disable"
        #Save lastused
        echo "$2" > $HOME/.kdebiglinux/lastused

        #Move config to use now
        for i in "${kde[@]}"; do
            cp -Rf /usr/share/biglinux/kdebiglinux/$2/$i ~/.config/
        done
        big-wallpaper-random
    fi
fi

big-theme-globalmenu

if [ "$2" = "vanilla" ]; then
    kwriteconfig6 --file ~/.config/kdeglobals --group Icons --key "Theme" "breeze"
fi

# Run specific desktop tweaks
/usr/share/biglinux/multi-kde/$2

# Enable gtkconfig in kde config
kwriteconfig6 --group Module-gtkconfig --file ~/.config/kded6rc --key autoload true

if [ "$3" = "quiet" ] || [ "$4" = "quiet" ]; then
    echo "No start services"
else

    qdbus6 org.kde.KWin /KWin org.kde.KWin.reconfigure
    qdbus6 org.kde.GtkConfig /GtkConfig org.kde.GtkConfig.setGtkTheme $(qdbus6 org.kde.GtkConfig /GtkConfig org.kde.GtkConfig.gtkTheme)
    gtk-reload.py
    systemctl --user start plasma-plasmashell
    systemctl --user start plasma-kglobalaccel.service
fi


if [ -e "$HOME/.config/lockplasma" ]; then
    qdbus6 org.kde.plasmashell /PlasmaShell evaluateScript "lockCorona(true)"
else
    qdbus6 org.kde.plasmashell /PlasmaShell evaluateScript "lockCorona(false)"
fi
;;

    --list)
for i  in  $(ls /usr/share/biglinux/kdebiglinux/); do
    echo "$i"
done
exit
;;

    *)
echo " Usage:
--list
--apply name-of-theme
--clean to restart theme

Example to apply classic theme:

big-theme-plasma --apply classic
or
big-theme-plasma --apply classic clean
or
big-theme-plasma --apply classic quiet


If use clean, remove configuration in home folder and use clean configuration.

Use quiet to change files but not instant apply"
exit
;;

esac


