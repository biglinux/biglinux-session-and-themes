#!/bin/bash


ENABLE_LATTE="$(cat ~/.config/enable_latte)"
if [ "$ENABLE_LATTE" != "1" ]; then
    systemctl --user stop lattedock
    exit
fi

# Change sistray applet
if [ ! -e "$HOME/.local/share/plasma/plasmoids" ]; then

    if [ -e "/usr/share/latte/org.kde.plasma.systemtray" ]; then
        mkdir -p ~/.local/share/plasma/plasmoids
        ln -s /usr/share/latte/org.kde.plasma.systemtray ~/.local/share/plasma/plasmoids/org.kde.plasma.systemtray
        ln -s /usr/share/latte/org.kde.plasma.private.systemtray ~/.local/share/plasma/plasmoids/org.kde.plasma.private.systemtray
    fi

fi

if [ "$(qdbus org.kde.ksmserver /KSMServer org.kde.KSMServerInterface.isShuttingDown)" = "false" ]; then

    if [ "$(cat "$HOME/.big_performance")" != "0" ] && [ "$(cat "$HOME/.big_performance")" != "" ]; then
        if [ "$ENABLE_LATTE" = "1" ]; then
            qdbus org.kde.lattedock /Latte org.kde.LatteDock.quitApplication
            QT_QUICK_BACKEND=software latte-dock 
        fi
    else
        if [ "$ENABLE_LATTE" = "1" ]; then
            qdbus org.kde.lattedock /Latte org.kde.LatteDock.quitApplication
            QT_QUICK_BACKEND="" QSG_RENDER_LOOP="" latte-dock
        fi
    fi
fi

sleep 1
